# poutils

<!-- vi:se ts=4 sts=4 tw=78 et ai: --> 

Osamu Aoki <osamu@debian.org>

This `poutils` provides generic helper programs and utility class:

* `po_clean`: Clean up msgstr matching msgid intelligently (excluding
  <screen>, http...).
* `po_update`: Update msgstr matching with the previous msgid with the
  updated msgid.
* `po_combine`: make a PO file from POT files generated from the master
  and translation data.
* `po_wdiff`: Convert the previous msgid data into the wdiff-like data
* `po_previous`: Revert changes made by `po_wdiff`

## The normal i18n workflow

Normal translation workflow using the `gettext` infrastructure is:

    master data --+--> POT --[translation]--> PO --+
                  +--------------------------------+--> translated data

Here, we mostly focus on text data such as DocBook XML, MarkDown,
ReStructuredText, ... as `data`.

The POT data is automatically generated without human intervention from the
master data.  Let's call this functionality as the POT extractor. E.g.: 

* `xgettext` (original tool by the `gettext` infrastructure covering strings
  in programs in C, Python, ...)
* `po4a-gettextize` without `-l` (extension tool `po4a` covering SGML, DocBookXML, ...)
* `itstool` with `-j` (extension tool `itstool` covering XML)
* `sphinx.builders.gettext` (MessageCatalogBuilder class in Sphinx covering RST)

The human translator adds the translation data to the POT data to make the PO data.

The PO data can be automatically updated by the updated POT data using
`msgmerge` when the master data is updated.

The translated data can be generated by the updated PO data and the master
data. (Sometimes the PO data may need to be converted to the MO format by
`msgfmt`.)

* `gettext()` (embedded function by the `gettext` infrastructure, alias is `_()`)
* `po4a-translate` (extension tool `po4a` generating l10n SGML, DocBookXML, ...)
* `itstool` with `-m` (extension tool `itstool` generating l10n XML)
* ??? (Sphinx may be converting directly to the final format data such html for
  each l10n targets from the combination of the master data and the PO data
  without generating l10n RST source.)
    * Easy way: `make gettext` in source tree makes POT

This workflow helps to keep up translated output in sync with the master
output.

## The reverse i18n workflow

When you decide to change data format, migration of the PO data is a
non-trivial task even if there is a good conversion tool from the old data
format to the new ones.  We need a reverse workflow to generate the PO data
from the master data and the translated data for any `gettext` derivative
infrastructure.

This `po_combine` provides a reverse workflow as follows:

    master data ------> POT --+
                              +--[po_combine] --> PO
    translated data --> POT --+

* the POT extractor of each tool infrastructure creates the master POT data by
  placing the converted master data in the normal master data position.
* the POT extractor of each tool infrastructure creates the translated POT
  data by placing the converted translated data in the normal master data
  position.
* Manually edit the converted master POT data and translated POT data to align
  and match exactly.
* the PO data generator `po_combine` creates the converted PO data from the
  master POT data and translated POT data.

The align and match task is optional.  If your PO system have files such as
add_*/ data, disabling such functionality will ensure matched source data to
avoid this task.

You can add some extracted markers such as untranslated strings (numbers,
embedded XML tags, ...) to the comment section of POT file before manually edit
them for alignment. This kind of marker strings and the original POT markers
such as "`#. type: Content of: <book><chapter><title>`" should make the align
and match task easier with this `po_combine` workflow.

For `po4a`, `po4a-gettextize` with `-l` option facilitates this functionality.
But I find its requirement to align and match the master data and the
translated data in their original format is more trouble than doing it on the
POT data.  So I see some advantage of `po_combine` over `po4a-gettextize` even
for `po4a`. YMMV.

TIP: `pandoc` is a nice document data format conversion tool.
      See Debian developers-reference transition history.


## Development of this package

### Git repo usage

debian/gbp.conf is set for:

* *master* : upstream development (quasi-native style with debian/*)
* *upstream* : upstream tarball (gbp import-dsc)
* *debian* : Debian source tree non-native style (gbp import-dsc)
* *pristine-tar* : pristine-tar of upstream tarball (gbp import-dsc)

### Package build

    $ python3 setup.py deb
    $ cd ../poutils-0.*
    $ pdebuild

